(()=>{"use strict";function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var e=function(){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,i;return n=e,(i=[{key:"load",value:function(t,e){var n=document.createElement("img");n.src="assets/Lander.png",n.width=250,t.appendChild(n);var i=document.createElement("h1");i.innerText="Lunar Lander",t.appendChild(i);var r=document.createElement("a");r.href="#",r.addEventListener("click",(function(){e.router.requestTransition("play",!0,{level:1})})),r.innerText="Play",t.appendChild(r);var o=document.createElement("a");o.href="#",o.addEventListener("click",(function(){e.router.requestTransition("controls")})),o.innerText="Controls",t.appendChild(o);var a=document.createElement("a");a.href="#",a.addEventListener("click",(function(){e.router.requestTransition("scores")})),a.innerText="High Scores",t.appendChild(a);var s=document.createElement("a");s.href="#",s.addEventListener("click",(function(){e.router.requestTransition("credits")})),s.innerText="Credits",t.appendChild(s)}},{key:"init",value:function(t){t.localState=void 0}},{key:"canTransition",value:function(t){return!0}},{key:"cleanup",value:function(t){}}])&&t(n.prototype,i),e}();function n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function i(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var r=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),i(this,"_x",0),i(this,"_y",0),this._x=e,this._y=n}var e,r,o;return e=t,o=[{key:"random",value:function(){return new t(Math.random(),Math.random()).normalize()}},{key:"distance",value:function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}}],(r=[{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"sqrMagnitude",value:function(){return Math.pow(this.x,2)+Math.pow(this.y,2)}},{key:"magnitude",value:function(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}},{key:"normalize",value:function(){var e=this.magnitude();return new t(this.x/e,this.y/e)}},{key:"scale",value:function(e){return new t(this.x*e,this.y*e)}},{key:"add",value:function(e){return new t(this.x+e.x,this.y+e.y)}},{key:"rotate",value:function(e){var n=e*Math.PI/180;return new t(this.x*Math.cos(n)-Math.sin(n)*this.y,this.x*Math.sin(n)+this.y*Math.cos(n))}},{key:"toString",value:function(){return"Vector2(x: ".concat(this.x,", y: ").concat(this.y,")")}}])&&n(e.prototype,r),o&&n(e,o),t}();i(r,"ZERO",new r(0,0));const o=r;function a(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function s(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e,n,i){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;e.ready&&(t.save(),t.translate(n.x,n.y),t.rotate(r*Math.PI/180),t.translate(-n.x,-n.y),t.drawImage(e.texture,n.x-i.x/2,n.y-i.y/2,i.x,i.y),t.restore())}var u=function(){function t(e,n){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),s(this,"size",void 0),s(this,"el",void 0),s(this,"ready",!1),this.el=new Image,this.el.src=e,this.el.addEventListener("load",(function(){i.ready=!0}))}var e,n;return e=t,(n=[{key:"texture",get:function(){return this.el}}])&&a(e.prototype,n),t}();function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function f(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function h(t,e,n){return e&&f(t.prototype,e),n&&f(t,n),t}function d(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var v=function(){function t(){c(this,t),d(this,"particles",void 0),this.particles=[]}return h(t,[{key:"update",value:function(t,e){this.particles=this.particles.filter((function(n){return n.update(t,e),n.remainingTime>0}))}},{key:"add",value:function(t){this.particles.push(t)}}]),t}(),y=function(){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;c(this,t),d(this,"position",void 0),d(this,"_rate",.1),d(this,"_elapsed",0),d(this,"_count",10),d(this,"_container",void 0),d(this,"_particleGenerator",void 0),d(this,"_predicate",void 0),this._container=new v,this._particleGenerator=e,this._predicate=n,this._count=r,this._rate=i}return h(t,[{key:"draw",value:function(t,e,n){this._container.particles.forEach((function(i){i.draw(t,e,n)}))}},{key:"update",value:function(t,e){if(this._predicate(e)&&(this._elapsed+=t,this._elapsed>this._rate)){this._elapsed-=this._rate;for(var n=0;n<this._count;n++)this._container.add(new p(this.position,this._particleGenerator.velocity(e),this._particleGenerator.lifetime(e),this._particleGenerator.rotation(e),this._particleGenerator.texture(e),this._particleGenerator.size(e)))}this._container.update(t,e)}}]),t}(),p=function(){function t(e,n,i,r,o,a){c(this,t),d(this,"_center",void 0),d(this,"_direction",void 0),d(this,"_velocity",void 0),d(this,"_lifetime",void 0),d(this,"_rotation",void 0),d(this,"_elapsedLifetime",void 0),d(this,"_texture",void 0),d(this,"_size",void 0),this._center=e,this._velocity=n,this._lifetime=i,this._rotation=r,this._texture=o,this._size=a,this._elapsedLifetime=0}return h(t,[{key:"draw",value:function(t,e,n){t.globalAlpha=1-this._elapsedLifetime/this._lifetime,l(t,this._texture,n.translate(this._center),n.translate(this._size),this._rotation),t.globalAlpha=1}},{key:"velocity",get:function(){return this._velocity}},{key:"direction",get:function(){return this._direction}},{key:"center",get:function(){return this._center}},{key:"remainingTime",get:function(){return this._lifetime-this._elapsedLifetime}},{key:"update",value:function(t,e){this._elapsedLifetime+=t,this._center=this._center.add(this._velocity.scale(t))}}]),t}();function g(t,e,n){var i=new o(n.x-e.x,n.y-e.y),r=new o(e.x-t.center.x,e.y-t.center.y),a=-2*(i.x*r.x+i.y*r.y),s=2*(i.x*i.x+i.y*i.y),l=Math.sqrt(a*a-2*s*(r.x*r.x+r.y*r.y-t.radius*t.radius));if(isNaN(l))return!1;var u=(a-l)/s,c=(a+l)/s;return u<=1&&u>=0||c<=1&&c>=0}function m(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var w=new(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n;return e=t,(n=[{key:"gaussian",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6,e=0,n=0;n<t;n++)e+=Math.random();return e/t-.5}}])&&m(e.prototype,n),t}());function b(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function k(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var _=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),k(this,"_center",void 0),k(this,"_radius",void 0),this._center=e,this._radius=n}var e,n;return e=t,(n=[{key:"center",get:function(){return this._center}},{key:"radius",get:function(){return this._radius}}])&&b(e.prototype,n),t}();function x(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function S(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function T(t,e,n){return e&&S(t.prototype,e),n&&S(t,n),t}function E(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var P=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;x(this,t),E(this,"_rotationOffset",void 0),E(this,"tex",new u("assets/Smoke.png",new o(32,32))),E(this,"_size",new o(.425,.425)),this._rotationOffset=e}return T(t,[{key:"texture",value:function(t){return this.tex}},{key:"size",value:function(t){return this._size}},{key:"velocity",value:function(t){var e=t.localState.lander.rotationVector,n=100*w.gaussian(12);return(e=e.rotate(n+this._rotationOffset)).scale(-5*w.gaussian(12))}},{key:"lifetime",value:function(t){return 5+w.gaussian(12)}},{key:"rotation",value:function(t){return 0}}]),t}(),O=function(){function t(){x(this,t),E(this,"tex",new u("assets/Fire.png",new o(32,32))),E(this,"_size",new o(.425,.425))}return T(t,[{key:"texture",value:function(t){return this.tex}},{key:"size",value:function(t){return this._size}},{key:"velocity",value:function(t){var e=t.localState.lander.rotationVector,n=360*Math.random();return(e=e.rotate(n)).scale(-20*w.gaussian(12))}},{key:"lifetime",value:function(t){return 2+w.gaussian(12)}},{key:"rotation",value:function(t){return 0}}]),t}(),C=function(){function t(e,n,i){var r=this;x(this,t),E(this,"size",void 0),E(this,"texture",void 0),E(this,"_frozen",void 0),E(this,"thrustEmitter",void 0),E(this,"leftRotationEmitter",void 0),E(this,"rightRotationEmitter",void 0),E(this,"explosionEmitter",void 0),E(this,"_position",void 0),E(this,"_velocity",void 0),E(this,"_rotationVector",void 0),E(this,"_rotation",void 0),E(this,"_explosionCount",0),E(this,"_isExploding",!1),E(this,"fuel",100),E(this,"crashed",!1),E(this,"thrusting",!1),E(this,"turningLeft",!1),E(this,"turningRight",!1),this.texture=n,this.size=i,this._frozen=!1,this._position=e,this._velocity=new o(0,0),this._rotationVector=new o(0,-1),this._rotation=0,this.thrustEmitter=new y(new P(180),(function(t){return t.localState.lander.thrusting&&t.localState.lander.fuel>0&&!r._frozen}),.03,5),this.leftRotationEmitter=new y(new P(90),(function(t){return t.localState.lander.turningLeft&&t.localState.lander.fuel>0&&!r._frozen}),.03,3),this.rightRotationEmitter=new y(new P(-90),(function(t){return t.localState.lander.turningRight&&t.localState.lander.fuel>0&&!r._frozen}),.03,3),this.explosionEmitter=new y(new O,(function(t){return r._isExploding}),.03,200),this.positionEmitters()}return T(t,[{key:"draw",value:function(t,e,n){e.localState.lander.crashed||l(t,this.texture,n.translate(this._position),n.translate(this.size),this._rotation),this.thrustEmitter.draw(t,e,n),this.leftRotationEmitter.draw(t,e,n),this.rightRotationEmitter.draw(t,e,n),this.explosionEmitter.draw(t,e,n)}},{key:"debugDraw",value:function(t,e,n){t.beginPath(),t.strokeStyle="#ffffff";var i=n.translate(this._position);t.arc(i.x,i.y,n.translate(new o(4,0)).x,0,2*Math.PI),t.stroke();var r=n.translate(this._position),a=n.translate(this._rotationVector.scale(5));t.beginPath(),this._rotation%360<5&&this._rotation%360>-5?t.strokeStyle="#00ff00":t.strokeStyle="#ff0000",t.lineTo(r.x,r.y),t.lineTo(r.x+a.x,r.y+a.y),t.stroke();var s=n.translate(this._velocity.normalize().scale(5));t.beginPath(),this._velocity.sqrMagnitude()<4?t.strokeStyle="#0000ff":t.strokeStyle="#ff0000",t.lineTo(r.x,r.y),t.lineTo(r.x+s.x,r.y+s.y),t.stroke()}},{key:"positionEmitters",value:function(){this.thrustEmitter.position=this._position.add(this._rotationVector.scale(-1.5)),this.leftRotationEmitter.position=this._position.add(this._rotationVector.rotate(70).scale(-1.75)),this.rightRotationEmitter.position=this._position.add(this._rotationVector.rotate(-70).scale(-1.75)),this.explosionEmitter.position=this._position}},{key:"update",value:function(t,e){if(this._isExploding&&(console.log("Explosion"),this._explosionCount++),this._explosionCount>5&&(this._isExploding=!1,this._explosionCount=0),this.thrustEmitter.update(t,e),this.leftRotationEmitter.update(t,e),this.rightRotationEmitter.update(t,e),this.explosionEmitter.update(t,e),!this._frozen){this.turningLeft&&this.fuel>0&&this.rotate(t,e,-1),this.turningRight&&this.fuel>0&&this.rotate(t,e,1),this._velocity=this._velocity.add(e.config.gravity.scale(t)),this.thrusting&&this.fuel>0&&(this._velocity=this._velocity.add(this._rotationVector.scale(t*e.config.thrustCoefficient)),this.fuel-=e.config.fuelConsumption*t),this.fuel<0&&(this.fuel=0,e.commands.execute("fuelExpired",e)),this._position=this._position.add(this._velocity.scale(t)),this.positionEmitters();for(var n=0;n<e.localState.terrain.points.length-1;n++)if(g(new _(this._position,2),e.localState.terrain.points[n],e.localState.terrain.points[n+1])){if(this.velocity.sqrMagnitude()<=4&&(this.rotation<5||this.rotation>355))for(var i=0;i<e.localState.safeZones.length;i++)if(e.localState.terrain.points[n]==e.localState.safeZones[i][0]&&e.localState.terrain.points[n+1]==e.localState.safeZones[i][1])return void e.commands.execute("safeLanding",e);e.commands.execute("crashLanding",e),this._isExploding=!0}(this.position.x>e.config.worldSize.x+10||this.position.x<-10||this.position.y>e.config.worldSize.y+10)&&(e.commands.execute("crashLanding",e),this._isExploding=!0)}}},{key:"rotate",value:function(t,e,n){this.fuel-=e.config.fuelConsumption*t*.5,this._rotation+=n*e.config.theta*t,this._rotationVector=this._rotationVector.rotate(n*e.config.theta*t)}},{key:"velocity",get:function(){return this._velocity}},{key:"rotation",get:function(){return(this._rotation%360+360)%360}},{key:"rotationVector",get:function(){return this._rotationVector}},{key:"position",get:function(){return this._position}},{key:"freeze",value:function(){this._frozen=!0,this._velocity=o.ZERO}},{key:"frozen",get:function(){return this._frozen}}]),t}();function j(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function z(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function L(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function M(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){r=!0,o=t}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}(t,e)||function(t,e){if(t){if("string"==typeof t)return R(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?R(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function R(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}var A=function(){function t(e,n,i,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:100;j(this,t),L(this,"points",void 0),this.points=[i,r];for(var s=0;s<e;s++){var l=this.points.length;n/=2;for(var u=0;u<l-1;u++){var c=new o((this.points[2*u].x+this.points[2*u+1].x)/2,(this.points[2*u].y+this.points[2*u+1].y)/2);c=c.add(new o(0,w.gaussian(12)*n)),c=new o(c.x,Math.min(c.y,a)),this.points.splice(2*u+1,0,c)}}}var e,n;return e=t,(n=[{key:"insertSafeZone",value:function(t,e,n){for(var i=t+n/2,r=i+(e-n/2-i)*Math.random(),a=0,s=this.points[0];s.x<r;)s=this.points[++a];var l=s;a++,s=this.points[a];for(var u=0;s.x<r+n;)u=s.x,this.points.splice(a,1),s=this.points[a];return this.points[a]=new o(u,l.y),[l,this.points[a]]}}])&&z(e.prototype,n),t}();function D(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function q(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var V=function(){function t(e,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),q(this,"scaleX",void 0),q(this,"scaleY",void 0),this.scaleX=e,this.scaleY=n,this.translate=this.translate.bind(this),this.translateValueX=this.translateValueX.bind(this),this.translateValueY=this.translateValueY.bind(this)}var e,n;return e=t,(n=[{key:"translate",value:function(t){return new o(t.x*this.scaleX,t.y*this.scaleY)}},{key:"translateValueX",value:function(t){return t*this.scaleX}},{key:"translateValueY",value:function(t){return t*this.scaleY}}])&&D(e.prototype,n),t}();function I(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function F(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function K(t){return(K="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function U(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function G(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Z(t,e,n){return(Z="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=X(t)););return t}(t,e);if(i){var r=Object.getOwnPropertyDescriptor(i,e);return r.get?r.get.call(n):r.value}})(t,e,n||t)}function Y(t,e){return(Y=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function B(t,e){return!e||"object"!==K(e)&&"function"!=typeof e?H(t):e}function H(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function X(t){return(X=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function $(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var N=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Y(t,e)}(s,t);var e,n,i,r,a=(i=s,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=X(i);if(r){var n=X(this).constructor;t=Reflect.construct(e,arguments,n)}else t=e.apply(this,arguments);return B(this,t)});function s(){var t;U(this,s);for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return $(H(t=a.call.apply(a,[this].concat(n))),"landerTexture",new u("assets/Lander.png",new o(500,500))),$(H(t),"fuelPosition",new o(5,5)),$(H(t),"anglePosition",new o(5,7.5)),$(H(t),"velocityPosition",new o(5,10)),$(H(t),"scorePosition",new o(5,12.5)),$(H(t),"countdownPosition",new o(5,15)),$(H(t),"countdown",0),t}return e=s,(n=[{key:"preLoad",value:function(t,e){Z(X(s.prototype),"setBounds",this).call(this,e.config.screenRatio,e.config.worldSize)}},{key:"postInit",value:function(t){var e=1,n=0;void 0!==t.router.transitionData&&(void 0!==t.router.transitionData.score&&(n=t.router.transitionData.score),void 0!==t.router.transitionData.level&&(e=t.router.transitionData.level));var i=new C(new o(t.config.worldSize.x/2,0),this.landerTexture,new o(5,5));this.countdown=0,this.drawables.push(i),this.ticking.push(i);for(var r=new A(8,500,new o(0,2*t.config.worldSize.y/3),new o(t.config.worldSize.x,2*t.config.worldSize.y/3),t.config.worldSize.y-10),a=[],s=3-e,l=(t.config.worldSize.x-10-10)/s,u=0;u<s;u++)a.push(r.insertSafeZone(10+l*u,10+l*(u+1),7.5*s));t.localState={running:!0,ticking:!0,level:e,safeZones:a,lander:i,terrain:r,score:n,transition:!1},t.keys.listening=!0}},{key:"canTransition",value:function(t){return!0}},{key:"loop",value:function(t){var e=this;return function n(i){var r=i-e.lastTime;e.lastTime=i,e.update(r/1e3,t),e.draw(t),t.localState.running&&requestAnimationFrame(n)}}},{key:"update",value:function(t,e){if(e.localState.ticking){for(var n=0;n<this.ticking.length;n++)this.ticking[n].update(t,e);e.localState.transition&&(this.countdown+=t)}}},{key:"draw",value:function(t){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),function(t,e,n){t.beginPath(),t.lineTo(n.translateValueX(0),n.translateValueY(e.config.worldSize.y));var i=t.createLinearGradient(0,0,0,1e3);i.addColorStop(0,"#ffffff"),i.addColorStop(1,"#777777");for(var r=1;r<e.localState.terrain.points.length;r++){var o=n.translate(e.localState.terrain.points[r]);t.lineTo(o.x,o.y)}t.lineTo(n.translateValueX(e.config.worldSize.x),n.translateValueY(e.config.worldSize.y)),t.fillStyle=i,t.fill();for(var a=0;a<e.localState.safeZones.length;a++){t.strokeStyle="#f69205",t.lineWidth=n.translateValueY(.5),t.beginPath();var s=M(e.localState.safeZones[a].map(n.translate),2),l=s[0],u=s[1];t.lineTo(l.x,l.y),t.lineTo(u.x,u.y),t.stroke()}}(this.context,t,this.vcs);for(var e=0;e<this.drawables.length;e++)this.drawables[e].draw(this.context,t,this.vcs);this.drawText(this.context,t)}},{key:"drawText",value:function(t,e){var n=this.vcs.translateValueX(2);t.font="".concat(n,"px Arial");var i=e.localState.lander.fuel;t.fillStyle=i>0?"#00ff00":"#ffffff";var r=this.vcs.translate(this.fuelPosition);t.fillText("Fuel: ".concat(i.toFixed(2),"L"),r.x,r.y);var o=e.localState.lander.rotation;t.fillStyle=o<5||o>355?"#00ff00":"#ffffff";var a=this.vcs.translate(this.anglePosition);t.fillText("Angle: ".concat(o.toFixed(2),"Â°"),a.x,a.y);var s=e.localState.lander.velocity.magnitude();t.fillStyle=s<2?"#00ff00":"#ffffff";var l=this.vcs.translate(this.velocityPosition);t.fillText("Velocity: ".concat(s.toFixed(2)," m/s"),l.x,l.y),t.fillStyle="#ffffff";var u=e.localState.level*e.localState.lander.fuel,c=this.vcs.translate(this.scorePosition);if(t.fillText("Score: ".concat((u+e.localState.score).toFixed(0)),c.x,c.y),e.localState.transition){var f=this.vcs.translate(this.countdownPosition);t.fillText("Next level in ".concat(Math.max(3-this.countdown,0).toFixed(2)),f.x,f.y)}}},{key:"cleanup",value:function(t){t.keys.listening=!1}}])&&G(e.prototype,n),s}(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),F(this,"canvas",void 0),F(this,"context",void 0),F(this,"vcs",new V(0,0)),F(this,"drawables",[]),F(this,"ticking",[]),F(this,"lastTime",0),F(this,"screenRatio",void 0),F(this,"worldSize",void 0)}var e,n;return e=t,(n=[{key:"setBounds",value:function(t,e){this.screenRatio=t,this.worldSize=e}},{key:"load",value:function(t,e){this.preLoad(t,e);var n=document.createElement("canvas");this.canvas=n,n.width=this.worldSize.x,n.height=this.worldSize.y,n.id="canvas",t.appendChild(n),this.context=n.getContext("2d"),this.postLoad(t,e)}},{key:"preLoad",value:function(t,e){}},{key:"postLoad",value:function(t,e){}},{key:"init",value:function(t){var e=this;this.preInit(t),this.drawables=[],this.ticking=[],this.postInit(t),this.lastTime=performance.now(),requestAnimationFrame(this.loop(t)),window.addEventListener("resize",(function(){return e.resize()})),this.resize()}},{key:"preInit",value:function(t){}},{key:"postInit",value:function(t){}},{key:"resize",value:function(){window.innerWidth/this.screenRatio.x<window.innerHeight/this.screenRatio.y?(this.canvas.width=window.innerWidth,this.canvas.height=window.innerWidth*this.screenRatio.y/this.screenRatio.x):(this.canvas.width=window.innerHeight*this.screenRatio.x/this.screenRatio.y,this.canvas.height=window.innerHeight),this.vcs=new V(this.canvas.width/this.worldSize.x,this.canvas.height/this.worldSize.y)}}])&&I(e.prototype,n),t}());function W(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function J(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Q=function(){function t(e,n){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),J(this,"el",void 0),J(this,"ready",!1),J(this,"continue",!1),J(this,"loop",!1),J(this,"_playing",!1),J(this,"cutoff",0),this.el=new Audio(e),this.el.addEventListener("load",(function(){i.ready=!0})),n&&(this.loop=!0,this.cutoff=n)}var e,n;return e=t,(n=[{key:"play",value:function(){var t=this;this.el.play(),this.continue=!0,this._playing=!0,this.loop?setTimeout((function(){t.continue&&(t.el.currentTime=0,t.playRec())}),1e3*this.cutoff):setTimeout((function(){return t._playing=!1}),1e3*this.el.duration)}},{key:"playRec",value:function(){var t=this;setTimeout((function(){t.continue&&(t.el.currentTime=0,t.playRec())}),1e3*this.cutoff)}},{key:"stop",value:function(){this.el.pause(),this.continue=!1,this._playing=!1,this.el.currentTime=0}},{key:"playing",get:function(){return this._playing}}])&&W(e.prototype,n),t}();function tt(t){return(tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function et(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return nt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?nt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function nt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function it(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function rt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ot(t,e,n){return e&&rt(t.prototype,e),n&&rt(t,n),t}function at(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var st=function(){function t(){it(this,t),at(this,"_wasPressed",!1),at(this,"_lastPressed",Date.now()),at(this,"_onStateChanged",new Set),at(this,"_onKeyUp",new Set),at(this,"_onKeyDown",new Set)}return ot(t,[{key:"update",value:function(t,e){if(this._wasPressed!=t){var n;n=t?this._onKeyDown:this._onKeyUp;var i,r=Date.now(),o=et(n);try{for(o.s();!(i=o.n()).done;)(0,i.value)(t,r-this._lastPressed,e)}catch(t){o.e(t)}finally{o.f()}var a,s=et(this._onStateChanged);try{for(s.s();!(a=s.n()).done;)(0,a.value)(t,r-this._lastPressed,e)}catch(t){s.e(t)}finally{s.f()}this._lastPressed=r,this._wasPressed=!this._wasPressed}}},{key:"addUp",value:function(t){this._onKeyUp.add(t)}},{key:"addDown",value:function(t){this._onKeyDown.add(t)}},{key:"addChanged",value:function(t){this._onStateChanged.add(t)}}]),t}(),lt=function(){function t(){it(this,t),at(this,"handlers",void 0),at(this,"descriptions",void 0),at(this,"_listening",void 0),window.addEventListener("keydown",this.updateDown.bind(this)),window.addEventListener("keyup",this.updateUp.bind(this)),this.handlers=new Map}return ot(t,[{key:"registerHandler",value:function(t,e){var n;this.handlers.has(t)?console.warn("Key handler registered twice for keyCode ".concat(t)):(this.handlers.set(t,new st),null===(n=this.descriptions)||void 0===n||n.set(t,e))}},{key:"bindUp",value:function(t,e){this.handlers.get(t).addUp(e)}},{key:"bindDown",value:function(t,e){this.handlers.get(t).addDown(e)}},{key:"bindChanged",value:function(t,e){this.handlers.get(t).addChanged(e)}},{key:"updateDown",value:function(t){this._listening&&this.handlers.has(t.key)&&(t.preventDefault(),this.handlers.get(t.key).update(!0,{alt:t.altKey,shift:t.shiftKey,ctrl:t.ctrlKey}))}},{key:"updateUp",value:function(t){this._listening&&this.handlers.has(t.key)&&(t.preventDefault(),this.handlers.get(t.key).update(!1,{alt:t.altKey,shift:t.shiftKey,ctrl:t.ctrlKey}))}},{key:"clear",value:function(){this.handlers=new Map}},{key:"remove",value:function(t){console.log("".concat(t," should be deleted.")),this.handlers.delete(t)}},{key:"listening",get:function(){return this._listening},set:function(t){this._listening=t}},{key:"hasKey",value:function(t){return this.handlers.has(t)}}]),t}();function ut(t,e,n,i,r){t.registerHandler(i,n),e.has("begin".concat(n))&&t.bindDown(i,(function(){return e.execute("begin".concat(n),r)})),e.has("end".concat(n))&&t.bindUp(i,(function(){return e.execute("end".concat(n),r)})),e.has("toggle".concat(n))&&t.bindChanged(i,(function(){return e.execute("toggle".concat(n),r)}))}function ct(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ft(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ht(t,e,n){return e&&ft(t.prototype,e),n&&ft(t,n),t}function dt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var vt=function(){function t(e,n){ct(this,t),dt(this,"_name",void 0),dt(this,"_action",void 0),this._name=e,this._action=n}return ht(t,[{key:"name",get:function(){return this._name}},{key:"invoke",value:function(t){this._action(t)}}]),t}(),yt=function(){function t(){ct(this,t),dt(this,"commands",void 0),this.commands=new Map}return ht(t,[{key:"createCommand",value:function(t,e){this.commands.set(t,new vt(t,e))}},{key:"has",value:function(t){return this.commands.has(t)}},{key:"execute",value:function(t,e){this.commands.has(t)?this.commands.get(t).invoke(e):console.warn("Attempting to invoke non-existent command ".concat(t))}}]),t}();function pt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var gt=function(){function t(){var e,n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n=void 0,(e="state")in this?Object.defineProperty(this,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[e]=n}var e,n;return e=t,(n=[{key:"load",value:function(t,e){var n=document.createElement("img");n.src="assets/Lander.png",n.width=250,t.appendChild(n);var i=document.createElement("h1");i.innerText="Credits",t.appendChild(i);var r=document.createElement("p");r.innerText="Lunar Lander Clone by Hunter Henrichsen";var o=document.createElement("p");o.innerText="Montserrat Font from Google Fonts",t.appendChild(r),t.appendChild(o);var a=document.createElement("a");a.href="#",a.addEventListener("click",(function(){e.router.requestTransition("home")})),a.innerText="Back",t.appendChild(a)}},{key:"init",value:function(t){t.localState=void 0,this.state=t}},{key:"canTransition",value:function(t){return!0}},{key:"cleanup",value:function(t){}}])&&pt(e.prototype,n),t}();function mt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function wt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var bt=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),wt(this,"_currentPage",void 0),wt(this,"_transitionData",{}),wt(this,"_pages",{}),wt(this,"_history",[]),wt(this,"requestTransition",void 0),this.requestTransition=this._requestTransition(e)}var e,n;return e=t,(n=[{key:"addPage",value:function(t,e){t in this._pages?console.warn("Trying to register duplicate page ".concat(t,"!")):this._pages[t]=e}},{key:"transitionData",get:function(){return this._transitionData}},{key:"pages",get:function(){return this._pages}},{key:"currentPage",get:function(){return this._currentPage}},{key:"_requestTransition",value:function(t){return function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;if(void 0!==this._pages[e]&&(void 0===this._currentPage||this._currentPage.canTransition(e))){n&&(this._history=[]),this._history.push(e),this._currentPage=this.pages[e],this._transitionData=i;var r=document.getElementById("main");r.innerHTML="",r.classList.forEach((function(t){return r.classList.remove(t)})),r.classList.add(e),this._currentPage.load(r,t),this._currentPage.init(t)}}}},{key:"previous",value:function(t){var e=this._history.slice(-2)[0];void 0!==e&&(this._currentPage.cleanup(t),this._history.splice(-2,2),this.requestTransition(e,!1))}}])&&mt(e.prototype,n),t}();function kt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function _t(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var xt=function(){function t(e,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),_t(this,"initializer",void 0),_t(this,"typeGuard",void 0),_t(this,"name",void 0),this.initializer=n,this.typeGuard=i,this.name=e}var e,n;return e=t,(n=[{key:"get",value:function(t){if(void 0===localStorage.getItem(this.name))return this.getDefault(t);var e=JSON.parse(localStorage.getItem(this.name));return this.typeGuard&&!this.typeGuard(e)?(console.warn("Found invalid shape of persistent data ".concat(name,". Using default.")),this.getDefault(t)):e}},{key:"getDefault",value:function(t){var e=this.initializer(t);return this.put(e),e}},{key:"put",value:function(t){localStorage.setItem(this.name,JSON.stringify(t))}}])&&kt(e.prototype,n),t}();function St(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Tt=function(){function t(){var e,n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),n=void 0,(e="state")in this?Object.defineProperty(this,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):this[e]=n,this.updateKey=this.updateKey.bind(this)}var e,n;return e=t,(n=[{key:"load",value:function(t,e){var n=this,i=e.persistence.get(e).eventMap,r=document.createElement("h1");r.innerText="Key Configuration",t.appendChild(r);var o=document.createElement("div");o.classList.add("btn-container");for(var a=function(){var t=l[s],r=document.createElement("button");r.id=t,r.innerText="".concat(t.replace(/([a-z](?=[A-Z]))/g,"$1 ")," (").concat(i[t],")"),r.addEventListener("click",(function(){n.setListeningEvent(e,t)})),o.appendChild(r)},s=0,l=Object.keys(i);s<l.length;s++)a();t.append(o);var u=document.createElement("a");u.href="#",u.addEventListener("click",(function(){e.router.requestTransition("home")})),u.innerText="Back",t.appendChild(u)}},{key:"init",value:function(t){t.localState={listeningEvent:""},this.state=t,document.addEventListener("keydown",this.updateKey)}},{key:"canTransition",value:function(t){return!0}},{key:"setListeningEvent",value:function(t,e){document.querySelectorAll("button").forEach((function(t){return t.classList.remove("waiting")})),t.localState.listeningEvent=e;var n=document.getElementById(e);n.classList.add("waiting"),n.innerText="Waiting for keypress..."}},{key:"cleanup",value:function(){document.removeEventListener("keydown",this.updateKey)}},{key:"updateKey",value:function(t){var e=this.state.persistence.get(this.state),n=e.eventMap,i=this.state,r=i.keys,o=i.commands,a=i.localState;if("Escape"==t.key)return t.stopPropagation(),""===a.listeningEvent?void this.state.router.previous(this.state):(document.querySelectorAll("button").forEach((function(t){t.innerText="".concat(t.id.replace(/([a-z](?=[A-Z]))/g,"$1 ")," (").concat(n[t.id],")"),t.classList.remove("waiting")})),void(a.listeningEvent=""));if(a.listeningEvent&&""!==a.listeningEvent){if(t.preventDefault(),r.hasKey(t.key)&&n[a.listeningEvent]!==t.key)return;var s=a.listeningEvent,l=n[s];this.state.keys.remove(l),ut(r,o,a.listeningEvent,t.key,this.state),n[s]=t.key;var u=document.getElementById(s);u.innerText="".concat(s.replace(/([a-z](?=[A-Z]))/g,"$1 ")," (").concat(n[s],")"),e.eventMap=n,this.state.persistence.put(e),a.listeningEvent="",u.classList.remove("waiting")}}}])&&St(e.prototype,n),t}();function Et(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var Pt=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),Et(this,"name",void 0),Et(this,"score",void 0),Object.assign(this,e)};function Ot(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function Ct(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,i)}return n}function jt(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Ct(Object(n),!0).forEach((function(e){zt(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ct(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function zt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Lt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Mt,Rt,At,Dt,qt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n;return e=t,(n=[{key:"load",value:function(t,e){var n=e.persistence.get(e),i=n.scores,r=document.createElement("h1");if(r.innerText="High Scores",t.appendChild(r),void 0!==e.router.transitionData){var o=e.router.transitionData.score;if("number"==typeof o&&(i.some((function(t){return Math.round(o)>t.score}))||i.length<5)){var a=document.createElement("div");a.classList.add("container");var s=document.createElement("p");s.innerText="You got a high score of ".concat(o.toFixed(0),"! Enter a name."),a.appendChild(s);var l=document.createElement("form"),u=document.createElement("input");u.type="text",l.appendChild(u);var c=document.createElement("input");c.type="submit",c.innerText="Submit",l.append(c),l.onsubmit=function(t){i.push(new Pt({name:u.value,score:parseInt(o.toFixed(0))})),i.sort((function(t){return t.score}));var r=jt(jt({},n),{},{scores:i.slice(0,4)});e.persistence.put(r),e.router.requestTransition("scores")},a.append(l),t.append(a)}}var f,h=function(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return Ot(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ot(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0,r=function(){};return{s:r,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(i.sort().reverse());try{for(h.s();!(f=h.n()).done;){var d=f.value,v=document.createElement("p");v.innerText="".concat(d.score," - ").concat(d.name),t.appendChild(v)}}catch(t){h.e(t)}finally{h.f()}var y=document.createElement("a");y.href="#",y.addEventListener("click",(function(){e.router.requestTransition("home")})),y.innerText="Back",t.appendChild(y)}},{key:"init",value:function(t){t.localState=void 0}},{key:"canTransition",value:function(t){return!0}},{key:"cleanup",value:function(t){}}])&&Lt(e.prototype,n),t}();(Rt=new o(4/3,1),At=Rt.scale(100),(Dt={commands:void 0,localState:void 0,keys:void 0,eventMap:new Map,config:{fuelConsumption:20,thrustCoefficient:10,theta:90,gravity:new o(0,1),worldSize:At,screenRatio:Rt},persistentState:void 0,sounds:{mainThruster:new Q("assets/mainthruster.wav",4),subThruster:new Q("assets/subthruster.wav",4),explosion:new Q("assets/explosion.wav"),landing:new Q("assets/landing.wav"),noFuel:new Q("assets/nofuel.wav",1)},router:void 0,persistence:void 0}).router=new bt(Dt),Dt.router.addPage("home",new e),Dt.router.addPage("play",new N),Dt.router.addPage("credits",new gt),Dt.router.addPage("scores",new qt),Dt.router.addPage("controls",new Tt),Dt.commands=((Mt=new yt).createCommand("changeThrustControl",(function(t){t.keys.remove})),Mt.createCommand("beginThrust",(function(t){t.localState.lander.frozen||(t.localState.lander.thrusting=!0,t.localState.lander.fuel>0?t.sounds.mainThruster.play():t.sounds.noFuel.play())})),Mt.createCommand("endThrust",(function(t){t.localState.lander.thrusting=!1,t.sounds.mainThruster.stop(),t.sounds.noFuel.stop()})),Mt.createCommand("fuelExpired",(function(t){t.localState.lander.frozen||(t.sounds.mainThruster.playing&&(t.sounds.mainThruster.stop(),t.sounds.noFuel.play()),t.sounds.subThruster.playing&&(t.sounds.subThruster.stop(),t.sounds.noFuel.play()))})),Mt.createCommand("beginTurnLeft",(function(t){t.localState.lander.frozen||(t.localState.lander.turningLeft=!0,t.localState.lander.fuel>0?t.sounds.subThruster.play():t.sounds.noFuel.play())})),Mt.createCommand("endTurnLeft",(function(t){t.localState.lander.frozen||(t.sounds.subThruster.stop(),t.sounds.noFuel.stop(),t.localState.lander.turningLeft=!1)})),Mt.createCommand("beginTurnRight",(function(t){t.localState.lander.frozen||(t.localState.lander.fuel>0?t.sounds.subThruster.play():t.sounds.noFuel.play(),t.localState.lander.turningRight=!0)})),Mt.createCommand("endTurnRight",(function(t){t.localState.lander.frozen||(t.sounds.subThruster.stop(),t.sounds.noFuel.stop(),t.localState.lander.turningRight=!1)})),Mt.createCommand("safeLanding",(function(t){t.sounds.landing.play(),t.localState.lander.freeze(),t.localState.transition=!0,setTimeout((function(){t.localState.running=!1,t.localState.score+=t.localState.lander.fuel*t.localState.level,2==t.localState.level?t.router.requestTransition("scores",!0,{score:t.localState.score}):t.router.requestTransition("play",!0,{level:2,score:t.localState.score})}),3e3)})),Mt.createCommand("crashLanding",(function(t){t.sounds.mainThruster.stop(),t.sounds.subThruster.stop(),t.sounds.noFuel.stop(),t.sounds.explosion.play(),t.localState.lander.crashed=!0,t.localState.lander.freeze(),setTimeout((function(){t.localState.running=!1,t.router.requestTransition("scores",!0,{score:t.localState.score})}),3e3)})),Mt),Dt.persistence=new xt("landerData",(function(){return{scores:[],eventMap:{Thrust:"UpArrow",TurnLeft:"LeftArrow",TurnRight:"RightArrow"}}}),(function(t){return t&&t.scores&&t.eventMap&&Array.isArray(t.scores)&&"object"===tt(t.eventMap)})),Dt.keys=function(t,e){for(var n=new lt,i=0,r=Object.keys(e);i<r.length;i++){var o=r[i];ut(n,t.commands,o,e[o],t)}return n}(Dt,Dt.persistence.get(Dt).eventMap),window.addEventListener("keydown",function(t){return function(e){if("Escape"===e.key){if(void 0!==t.localState&&void 0!==t.localState.ticking&&"boolean"==typeof t.localState.ticking)return void(t.localState.ticking=!t.localState.ticking);t.router.previous(t)}}}(Dt)),Dt).router.requestTransition("home")})();